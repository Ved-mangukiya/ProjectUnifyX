<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnifyX Finance Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #6366F1;
            --primary-light: #8B5CF6;
            --secondary: #F3F4F6;
            --accent: #10B981;
            --danger: #EF4444;
            --success: #22C55E;
            --warning: #F59E0B;
            --info: #3B82F6;
            --dark: #1F2937;
            --light: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            --background: var(--gray-50);
            --card-bg: var(--light);
            --text: var(--gray-900);
            --text-muted: var(--gray-500);
            --border: var(--gray-200);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] {
            --background: #0F172A;
            --card-bg: #1E293B;
            --text: #F1F5F9;
            --text-muted: #94A3B8;
            --border: #334155;
            --gray-50: #1E293B;
            --gray-100: #334155;
            --gray-200: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', system-ui, Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--background) 0%, #E0E7FF 100%);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 100px;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            padding: 16px;
            margin: 0 auto;
        }

        .topbar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            padding: 20px 24px;
            border-radius: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 16px;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .topbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topbar h1 {
            font-size: 24px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .topbar h1 i {
            font-size: 28px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-actions .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 12px;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .balance-card {
            background: linear-gradient(135deg, var(--success) 0%, var(--accent) 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 50%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .balance-info h3 {
            font-size: 16px;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-icon.income { background: linear-gradient(135deg, var(--success), var(--accent)); }
        .stat-icon.expense { background: linear-gradient(135deg, var(--danger), #FF6B9D); }
        .stat-icon.debtor { background: linear-gradient(135deg, var(--warning), #FFA726); }
        .stat-icon.creditor { background: linear-gradient(135deg, var(--info), #42A5F5); }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 500;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text);
        }

        .btn {
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--border);
        }

        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: var(--warning); }
        .btn-info { background: var(--info); }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            background: var(--card-bg);
        }

        .transaction-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow);
        }

        .transaction-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .transaction-type {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .transaction-type.income {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
            color: var(--success);
        }

        .transaction-type.expense {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(255, 107, 157, 0.1));
            color: var(--danger);
        }

        .transaction-type.transfer {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            color: var(--primary);
        }

        .transaction-description {
            font-weight: 500;
            color: var(--text);
            margin: 4px 0;
        }

        .transaction-details {
            color: var(--text-muted);
            font-size: 13px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .transaction-amount {
            font-size: 18px;
            font-weight: 700;
            text-align: right;
        }

        .amount-positive {
            color: var(--success);
        }

        .amount-negative {
            color: var(--danger);
        }

        .fab {
            position: fixed;
            right: 24px;
            bottom: 100px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
            z-index: 100;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(99, 102, 241, 0.5);
        }

        .fab-menu {
            position: fixed;
            right: 24px;
            bottom: 180px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 90;
        }

        .fab-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .fab-menu .btn {
            min-width: 180px;
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            backdrop-filter: blur(20px);
            z-index: 90;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-muted);
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .bottom-nav-item.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .bottom-nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .bottom-nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: var(--gray-100);
            color: var(--text);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px 24px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--text);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transform: translateX(100%);
            transition: all 0.3s ease;
            max-width: 400px;
        }

        .toast.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-error {
            border-left: 4px solid var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .quick-action {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 16px;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-weight: 500;
        }

        .quick-action:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        .quick-action i {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 50;
            display: none;
        }

        .insights-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 24px;
            margin: 16px 0;
        }

        .spending-chart {
            height: 200px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .topbar {
                padding: 16px 20px;
                border-radius: 16px;
            }

            .topbar h1 {
                font-size: 20px;
            }

            .balance-amount {
                font-size: 28px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .fab {
                right: 16px;
                bottom: 80px;
                width: 56px;
                height: 56px;
            }

            .fab-menu {
                right: 16px;
                bottom: 150px;
            }

            .modal-content {
                margin: 20px;
                max-height: 85vh;
            }

            .filters {
                grid-template-columns: 1fr;
            }
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feature-highlight {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            padding: 20px;
            border-radius: 16px;
            margin: 16px 0;
            text-align: center;
            color: white;
        }

        .budget-progress {
            background: var(--gray-100);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
            transition: width 0.3s ease;
        }

        .simple-statement {
            background: var(--gray-50);
            padding: 16px;
            border-radius: 12px;
            margin: 8px 0;
            border-left: 4px solid var(--primary);
        }

        .simple-statement .action {
            font-weight: 600;
            color: var(--primary);
        }

        .simple-statement .amount {
            font-weight: 700;
            font-size: 16px;
        }

        .simple-statement .date {
            color: var(--text-muted);
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <div id="overlay" class="overlay"></div>

    <header class="topbar">
        <div class="topbar-content">
            <h1><i class="fas fa-wallet"></i> UnifyX Finance Manager</h1>
            <div class="header-actions">
                <button id="settings-btn" class="btn btn-sm">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button id="insights-btn" class="btn btn-sm">
                    <i class="fas fa-chart-line"></i> Insights
                </button>
            </div>
        </div>
    </header>

    <nav class="bottom-nav">
        <a href="#dashboard" class="bottom-nav-item active" data-section="dashboard">
            <i class="fas fa-home"></i>
            <span class="bottom-nav-label">Home</span>
        </a>
        <a href="#transactions" class="bottom-nav-item" data-section="transactions">
            <i class="fas fa-exchange-alt"></i>
            <span class="bottom-nav-label">Transactions</span>
        </a>
        <a href="#debts" class="bottom-nav-item" data-section="debts">
            <i class="fas fa-handshake"></i>
            <span class="bottom-nav-label">Debts</span>
        </a>
        <a href="#budgets" class="bottom-nav-item" data-section="budgets">
            <i class="fas fa-chart-pie"></i>
            <span class="bottom-nav-label">Budgets</span>
        </a>
        <a href="#categories" class="bottom-nav-item" data-section="categories">
            <i class="fas fa-tags"></i>
            <span class="bottom-nav-label">Categories</span>
        </a>
    </nav>

    <div class="fab" id="fab">
        <i class="fas fa-plus"></i>
    </div>
    
    <div id="fab-menu" class="fab-menu">
        <button id="btn-add-expense" class="btn">
            <i class="fas fa-minus-circle"></i> Add Expense
        </button>
        <button id="btn-add-income" class="btn">
            <i class="fas fa-plus-circle"></i> Add Income
        </button>
        <button id="btn-add-transfer" class="btn">
            <i class="fas fa-exchange-alt"></i> Transfer Money
        </button>
        <button id="btn-add-debt" class="btn">
            <i class="fas fa-handshake"></i> Lend/Borrow
        </button>
        <button id="btn-add-account" class="btn">
            <i class="fas fa-university"></i> Add Account
        </button>
    </div>

    <div class="container">
        <main id="page-content">
            <!-- Setup Wallet -->
            <div id="setup-wallet" class="card" style="display: none;">
                <h2><i class="fas fa-rocket"></i> Welcome! Let's Set Up Your Wallet</h2>
                <p style="color: var(--text-muted); margin: 16px 0;">Enter your starting money to begin tracking your finances</p>
                
                <div class="form-group">
                    <label><i class="fas fa-money-bill-wave"></i> Cash in Hand</label>
                    <input id="setup-cash" type="number" step="0.01" value="0" placeholder="How much cash do you have?">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-university"></i> Bank Balance</label>
                    <input id="setup-bank" type="number" step="0.01" value="0" placeholder="How much money in bank?">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-coins"></i> Currency</label>
                    <select id="currency-select">
                        <option value="₹">₹ (Indian Rupee)</option>
                        <option value="$">$ (US Dollar)</option>
                        <option value="€">€ (Euro)</option>
                        <option value="£">£ (British Pound)</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button id="skip-setup" class="btn btn-secondary">Skip for Now</button>
                    <button id="save-wallet-btn" class="btn">
                        <i class="fas fa-check"></i> Start Managing Money
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section class="section active" id="dashboard">
                <div id="dashboard-content">
                    <!-- Balance Card -->
                    <div class="balance-card">
                        <div class="balance-header">
                            <div class="balance-info">
                                <h3><i class="fas fa-wallet"></i> Total Money You Have</h3>
                                <div id="total-balance" class="balance-amount">₹0.00</div>
                            </div>
                            <button id="view-accounts" class="btn btn-sm" style="background: rgba(255,255,255,0.2);">
                                <i class="fas fa-eye"></i> View All Accounts
                            </button>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid" id="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon expense">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                                <div>
                                    <div class="stat-value" id="month-expenses">₹0.00</div>
                                    <div class="stat-label">This Month Spent</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon income">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <div>
                                    <div class="stat-value" id="month-income">₹0.00</div>
                                    <div class="stat-label">This Month Earned</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon debtor">
                                    <i class="fas fa-hand-holding-usd"></i>
                                </div>
                                <div>
                                    <div class="stat-value" id="active-debtors">₹0.00</div>
                                    <div class="stat-label">People Owe You</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon creditor">
                                    <i class="fas fa-hand-holding"></i>
                                </div>
                                <div>
                                    <div class="stat-value" id="active-creditors">₹0.00</div>
                                    <div class="stat-label">You Owe Others</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-title">
                            <span><i class="fas fa-zap"></i> Quick Actions</span>
                        </div>
                        <div class="quick-actions">
                            <button class="quick-action" id="quick-expense">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Add Expense</span>
                            </button>
                            <button class="quick-action" id="quick-income">
                                <i class="fas fa-coins"></i>
                                <span>Add Income</span>
                            </button>
                            <button class="quick-action" id="quick-transfer">
                                <i class="fas fa-exchange-alt"></i>
                                <span>Transfer</span>
                            </button>
                            <button class="quick-action" id="quick-debt">
                                <i class="fas fa-handshake"></i>
                                <span>Lend/Borrow</span>
                            </button>
                        </div>
                    </div>

                    <!-- Recent Transactions -->
                    <div class="card">
                        <div class="card-title">
                            <span><i class="fas fa-history"></i> Recent Activity</span>
                            <button id="view-all-transactions" class="btn btn-sm">
                                <i class="fas fa-list"></i> View All
                            </button>
                        </div>
                        <div id="recent-transactions">
                            <div class="empty-state">
                                <i class="fas fa-receipt"></i>
                                <h3>No Transactions Yet</h3>
                                <p>Start by adding your first expense or income</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transactions Section -->
            <section class="section" id="transactions">
                <div class="card">
                    <div class="card-title">
                        <span><i class="fas fa-list"></i> All Transactions</span>
                        <button id="export-pdf" class="btn btn-sm">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                    
                    <div class="filters">
                        <div class="form-group">
                            <label>From Date</label>
                            <input type="date" id="filter-from">
                        </div>
                        <div class="form-group">
                            <label>To Date</label>
                            <input type="date" id="filter-to">
                        </div>
                        <div class="form-group">
                            <label>Type</label>
                            <select id="filter-type">
                                <option value="all">All Types</option>
                                <option value="expense">Money Spent</option>
                                <option value="income">Money Received</option>
                                <option value="transfer">Money Transferred</option>
                                <option value="lending">Money Lent</option>
                                <option value="borrowing">Money Borrowed</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 12px; align-items: end;">
                            <button id="apply-filters" class="btn">
                                <i class="fas fa-filter"></i> Apply Filter
                            </button>
                            <button id="clear-filters" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>

                    <div id="transactions-list"></div>
                </div>
            </section>

            <!-- Debts Section -->
            <section class="section" id="debts">
                <div class="card">
                    <div class="card-title">
                        <span><i class="fas fa-handshake"></i> Money Lending & Borrowing</span>
                    </div>
                    
                    <div class="filter-group">
                        <button class="btn btn-sm active" data-debt-filter="all">All</button>
                        <button class="btn btn-sm btn-success" data-debt-filter="lending">People Owe Me</button>
                        <button class="btn btn-sm btn-danger" data-debt-filter="borrowing">I Owe Others</button>
                    </div>
                    
                    <div id="debts-list">
                        <div class="empty-state">
                            <i class="fas fa-handshake"></i>
                            <h3>No Debts</h3>
                            <p>Track money you lend or borrow here</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Budgets Section -->
            <section class="section" id="budgets">
                <div class="card">
                    <div class="card-title">
                        <span><i class="fas fa-chart-pie"></i> Monthly Budgets</span>
                        <button class="btn btn-sm" id="add-budget-btn">
                            <i class="fas fa-plus"></i> Add Budget
                        </button>
                    </div>
                    
                    <div id="budgets-list">
                        <div class="empty-state">
                            <i class="fas fa-chart-pie"></i>
                            <h3>No Budgets Set</h3>
                            <p>Create budgets to control your spending</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Categories Section -->
            <section class="section" id="categories">
                <div class="card">
                    <div class="card-title">
                        <span><i class="fas fa-tags"></i> Transaction Categories</span>
                        <button class="btn btn-sm" id="add-category-btn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                    
                    <div id="categories-list">
                        <div class="empty-state">
                            <i class="fas fa-tags"></i>
                            <h3>No Custom Categories</h3>
                            <p>Add categories to organize your transactions</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Insights Section -->
            <section class="section" id="insights">
                <div class="insights-card">
                    <h2><i class="fas fa-chart-line"></i> Financial Insights</h2>
                    <p>Smart analysis of your spending patterns</p>
                </div>
                
                <div class="card">
                    <div class="card-title">Spending Analysis</div>
                    <canvas id="spending-chart" class="spending-chart"></canvas>
                </div>
                
                <div class="card">
                    <div class="card-title">Monthly Trends</div>
                    <div id="monthly-trends"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- All Modals -->
    <div id="modal-root">
        <!-- Expense Modal -->
        <div class="modal" id="expense-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-minus-circle"></i> Add Money Spent</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>How much money did you spend?</label>
                        <input type="number" id="expense-amount" placeholder="Enter amount" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>What category?</label>
                        <select id="expense-category"></select>
                    </div>
                    <div class="form-group">
                        <label>What did you buy/pay for?</label>
                        <input type="text" id="expense-description" placeholder="e.g., Groceries, Rent, Food">
                    </div>
                    <div class="form-group">
                        <label>When?</label>
                        <input type="date" id="expense-date">
                    </div>
                    <div class="form-group">
                        <label>From which account?</label>
                        <select id="expense-account"></select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-expense">
                        <i class="fas fa-save"></i> Save Expense
                    </button>
                </div>
            </div>
        </div>

        <!-- Income Modal -->
        <div class="modal" id="income-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-plus-circle"></i> Add Money Received</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>How much money did you receive?</label>
                        <input type="number" id="income-amount" placeholder="Enter amount" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>What type of income?</label>
                        <select id="income-category"></select>
                    </div>
                    <div class="form-group">
                        <label>Source of money?</label>
                        <input type="text" id="income-description" placeholder="e.g., Salary, Gift, Business">
                    </div>
                    <div class="form-group">
                        <label>When?</label>
                        <input type="date" id="income-date">
                    </div>
                    <div class="form-group">
                        <label>To which account?</label>
                        <select id="income-account"></select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-income">
                        <i class="fas fa-save"></i> Save Income
                    </button>
                </div>
            </div>
        </div>

        <!-- Debt Modal -->
        <div class="modal" id="debt-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-handshake"></i> Lend or Borrow Money</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>What type?</label>
                        <select id="debt-type">
                            <option value="lending">I gave money to someone (Lending)</option>
                            <option value="borrowing">Someone gave money to me (Borrowing)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>How much money?</label>
                        <input type="number" id="debt-amount" placeholder="Enter amount" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Person's name</label>
                        <input type="text" id="debt-person" placeholder="Enter person's name">
                    </div>
                    <div class="form-group">
                        <label>Reason/Description</label>
                        <input type="text" id="debt-description" placeholder="Why was money given?">
                    </div>
                    <div class="form-group">
                        <label>When?</label>
                        <input type="date" id="debt-date">
                    </div>
                    <div class="form-group">
                        <label>From/To which account?</label>
                        <select id="debt-account"></select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-debt">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
        </div>

        <!-- Transfer Modal -->
        <div class="modal" id="transfer-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-exchange-alt"></i> Transfer Money Between Accounts</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>How much to transfer?</label>
                        <input type="number" id="transfer-amount" placeholder="Enter amount" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>From which account?</label>
                        <select id="transfer-from"></select>
                    </div>
                    <div class="form-group">
                        <label>To which account?</label>
                        <select id="transfer-to"></select>
                    </div>
                    <div class="form-group">
                        <label>Reason for transfer</label>
                        <input type="text" id="transfer-description" placeholder="Optional description">
                    </div>
                    <div class="form-group">
                        <label>When?</label>
                        <input type="date" id="transfer-date">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-transfer">
                        <i class="fas fa-save"></i> Transfer Money
                    </button>
                </div>
            </div>
        </div>

        <!-- Other modals for accounts, budgets, categories, settings, etc. -->
        <div class="modal" id="accounts-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-university"></i> Your Accounts</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div id="accounts-list"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Close</button>
                    <button class="btn" id="add-new-account-btn">
                        <i class="fas fa-plus"></i> Add New Account
                    </button>
                </div>
            </div>
        </div>

        <!-- Add Account Modal -->
        <div class="modal" id="add-account-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-plus"></i> Add New Account</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Account Name</label>
                        <input type="text" id="account-name" placeholder="e.g., SBI Bank, Wallet">
                    </div>
                    <div class="form-group">
                        <label>Account Type</label>
                        <select id="account-type">
                            <option value="cash">Cash</option>
                            <option value="bank">Bank Account</option>
                            <option value="credit">Credit Card</option>
                            <option value="investment">Investment</option>
                            <option value="others">Others</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Starting Balance</label>
                        <input type="number" id="account-balance" placeholder="Current money in this account" step="0.01">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-account">
                        <i class="fas fa-save"></i> Add Account
                    </button>
                </div>
            </div>
        </div>

        <!-- Budget Modal -->
        <div class="modal" id="budget-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-chart-pie"></i> Set Spending Budget</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Category to budget</label>
                        <select id="budget-category"></select>
                    </div>
                    <div class="form-group">
                        <label>Maximum amount to spend</label>
                        <input type="number" id="budget-amount" placeholder="Enter budget limit" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Time period</label>
                        <select id="budget-period">
                            <option value="monthly">Monthly</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-budget">
                        <i class="fas fa-save"></i> Create Budget
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settings-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-cog"></i> Settings</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Currency</label>
                        <select id="settings-currency">
                            <option value="₹">₹ (Indian Rupee)</option>
                            <option value="$">$ (US Dollar)</option>
                            <option value="€">€ (Euro)</option>
                            <option value="£">£ (British Pound)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Theme</label>
                        <select id="settings-theme">
                            <option value="light">Light Mode</option>
                            <option value="dark">Dark Mode</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Import Data</label>
                        <input type="file" id="import-data" accept=".xlsx,.xls">
                        <small style="color: var(--text-muted);">Upload Excel file to import data</small>
                    </div>
                    <div class="form-group">
                        <button class="btn" id="export-data">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-danger" id="reset-data">
                            <i class="fas fa-trash"></i> Reset All Data
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Close</button>
                    <button class="btn" id="save-settings">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- Category Modal -->
        <div class="modal" id="category-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-tags"></i> Add New Category</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Category Name</label>
                        <input type="text" id="category-name" placeholder="e.g., Entertainment, Travel">
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="category-type">
                            <option value="expense">Expense (Money Out)</option>
                            <option value="income">Income (Money In)</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-category">
                        <i class="fas fa-save"></i> Add Category
                    </button>
                </div>
            </div>
        </div>

        <!-- Repay Debt Modal -->
        <div class="modal" id="repay-debt-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-check-circle"></i> Collect/Repay Money</div>
                    <button class="close-modal">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Amount to collect/repay</label>
                        <input type="number" id="repay-amount" placeholder="Enter amount" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>When?</label>
                        <input type="date" id="repay-date">
                    </div>
                    <div class="form-group">
                        <label>To/From which account?</label>
                        <select id="repay-account"></select>
                    </div>
                    <input type="hidden" id="repay-debt-index">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal-btn">Cancel</button>
                    <button class="btn" id="save-repay-debt">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer style="background: var(--card-bg); padding: 20px; text-align: center; margin-top: 40px; border-radius: 20px 20px 0 0;">
        <p style="color: var(--text-muted);">© <span id="current-year"></span> Mangukiya Ved. Made with ❤️ for better financial management</p>
    </footer>

    <script>
        // Storage keys - using in-memory storage instead of localStorage
        let accounts = [
            { id: 'cash', name: 'Cash', type: 'cash', initialBalance: 0, balance: 0 },
            { id: 'bank', name: 'Bank', type: 'bank', initialBalance: 0, balance: 0 }
        ];
        let transactions = [];
        let debts = [];
        let budgets = [];
        let categories = [
            { id: 'food', name: 'Food & Dining', type: 'expense' },
            { id: 'groceries', name: 'Groceries', type: 'expense' },
            { id: 'transport', name: 'Transportation', type: 'expense' },
            { id: 'entertainment', name: 'Entertainment', type: 'expense' },
            { id: 'utilities', name: 'Bills & Utilities', type: 'expense' },
            { id: 'healthcare', name: 'Healthcare', type: 'expense' },
            { id: 'shopping', name: 'Shopping', type: 'expense' },
            { id: 'others-expense', name: 'Others', type: 'expense' },
            { id: 'salary', name: 'Salary', type: 'income' },
            { id: 'business', name: 'Business', type: 'income' },
            { id: 'freelance', name: 'Freelance', type: 'income' },
            { id: 'investment', name: 'Investment Returns', type: 'income' },
            { id: 'gift', name: 'Gift/Bonus', type: 'income' },
            { id: 'others-income', name: 'Others', type: 'income' },
            { id: 'lending', name: 'Lending', type: 'expense' },
            { id: 'borrowing', name: 'Borrowing', type: 'income' },
            { id: 'transfer', name: 'Transfer', type: 'transfer' }
        ];
        let settings = {
            initialized: false,
            currency: '₹',
            theme: 'light',
            initialBalances: {}
        };
        let currentFilter = 'all';
        let currentDebtFilter = 'all';

        // Utility functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageSpan = document.getElementById('toast-message');
            if (toast && messageSpan) {
                messageSpan.textContent = message;
                toast.className = `toast active toast-${type}`;
                setTimeout(() => toast.classList.remove('active'), 3000);
            }
        }

        function formatCurrency(amount) {
            const value = Number(amount || 0).toFixed(2);
            return `${settings.currency}${value}`;
        }

        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                return date.toLocaleDateString('en-IN');
            } catch {
                return dateStr;
            }
        }

        function formatDateTime(dateStr) {
            try {
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                return date.toLocaleDateString('en-IN') + ' ' + date.toLocaleTimeString('en-IN', {hour: '2-digit', minute: '2-digit'});
            } catch {
                return dateStr;
            }
        }

        function uid(prefix = 'id') {
            return prefix + '_' + Math.random().toString(36).slice(2, 9);
        }

        function todayISO() {
            return new Date().toISOString().split('T')[0];
        }

        function applyTheme() {
            document.documentElement.setAttribute('data-theme', settings.theme);
        }

        function setCurrentYear() {
            const yearSpan = document.getElementById('current-year');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }
        }

        // Initialize default accounts
        function initDefaultAccounts(cash = 0, bank = 0) {
            accounts = [
                { id: 'cash', name: 'Cash', type: 'cash', initialBalance: Number(cash || 0), balance: Number(cash || 0) },
                { id: 'bank', name: 'Bank', type: 'bank', initialBalance: Number(bank || 0), balance: Number(bank || 0) }
            ];
            settings.initialBalances = { cash: accounts[0].initialBalance, bank: accounts[1].initialBalance };
            settings.initialized = true;
        }

        // Recalculate balances
        function recomputeBalances() {
            const balances = {};
            accounts.forEach(a => balances[a.id] = Number(a.initialBalance || 0));
            
            transactions.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(tx => {
                if (tx.type === 'expense' || tx.type === 'lending') {
                    balances[tx.account] = (balances[tx.account] || 0) - Number(tx.amount || 0);
                } else if (tx.type === 'income' || tx.type === 'borrowing') {
                    balances[tx.account] = (balances[tx.account] || 0) + Number(tx.amount || 0);
                } else if (tx.type === 'transfer') {
                    balances[tx.fromAccount || tx.account] = (balances[tx.fromAccount || tx.account] || 0) - Number(tx.amount || 0);
                    balances[tx.toAccount] = (balances[tx.toAccount] || 0) + Number(tx.amount || 0);
                }
            });
            
            accounts.forEach(a => a.balance = Number(balances[a.id] || 0));
        }

        // Update UI
        function updateUI() {
            try {
                // Total balance
                const totalBalance = document.getElementById('total-balance');
                if (totalBalance) {
                    const total = accounts.reduce((sum, acc) => sum + (acc.balance || 0), 0);
                    totalBalance.textContent = formatCurrency(total);
                }

                // Monthly stats
                const monthExpenses = document.getElementById('month-expenses');
                const monthIncome = document.getElementById('month-income');
                const activeDebtors = document.getElementById('active-debtors');
                const activeCreditors = document.getElementById('active-creditors');
                
                if (monthExpenses && monthIncome && activeDebtors && activeCreditors) {
                    const now = new Date();
                    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                    
                    const expenses = transactions
                        .filter(t => t.type === 'expense' && new Date(t.date) >= monthStart)
                        .reduce((sum, t) => sum + (t.amount || 0), 0);
                    
                    const income = transactions
                        .filter(t => t.type === 'income' && new Date(t.date) >= monthStart)
                        .reduce((sum, t) => sum + (t.amount || 0), 0);
                    
                    const debtorsAmount = debts
                        .filter(d => d.type === 'lending')
                        .reduce((sum, d) => sum + (d.amount || 0), 0);
                    
                    const creditorsAmount = debts
                        .filter(d => d.type === 'borrowing')
                        .reduce((sum, d) => sum + (d.amount || 0), 0);

                    monthExpenses.textContent = formatCurrency(expenses);
                    monthIncome.textContent = formatCurrency(income);
                    activeDebtors.textContent = formatCurrency(debtorsAmount);
                    activeCreditors.textContent = formatCurrency(creditorsAmount);
                }

                // Recent transactions - Simple format
                const recentContainer = document.getElementById('recent-transactions');
                if (recentContainer) {
                    recentContainer.innerHTML = '';
                    const recent = [...transactions].slice(-5).reverse();
                    
                    if (recent.length === 0) {
                        recentContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-receipt"></i>
                                <h3>No Transactions Yet</h3>
                                <p>Start by adding your first expense or income</p>
                            </div>`;
                    } else {
                        recent.forEach(tx => {
                            const categoryObj = categories.find(c => c.id === tx.category);
                            const accountObj = accounts.find(a => a.id === tx.account);
                            
                            // Create simple statement
                            let statement = '';
                            let amountClass = '';
                            let typeIcon = '';
                            
                            if (tx.type === 'expense') {
                                statement = `You spent ${formatCurrency(tx.amount)} on ${tx.description || categoryObj?.name || 'expense'} from ${accountObj?.name || 'account'}`;
                                amountClass = 'amount-negative';
                                typeIcon = 'fas fa-minus-circle';
                            } else if (tx.type === 'income') {
                                statement = `You received ${formatCurrency(tx.amount)} from ${tx.description || categoryObj?.name || 'income'} to ${accountObj?.name || 'account'}`;
                                amountClass = 'amount-positive';
                                typeIcon = 'fas fa-plus-circle';
                            } else if (tx.type === 'transfer') {
                                const toAccountObj = accounts.find(a => a.id === tx.toAccount);
                                statement = `You moved ${formatCurrency(tx.amount)} from ${accountObj?.name || 'account'} to ${toAccountObj?.name || 'account'}`;
                                amountClass = 'amount-neutral';
                                typeIcon = 'fas fa-exchange-alt';
                            } else if (tx.type === 'lending') {
                                statement = `You lent ${formatCurrency(tx.amount)} to ${tx.person || 'someone'} from ${accountObj?.name || 'account'}`;
                                amountClass = 'amount-negative';
                                typeIcon = 'fas fa-hand-holding-usd';
                            } else if (tx.type === 'borrowing') {
                                statement = `You borrowed ${formatCurrency(tx.amount)} from ${tx.person || 'someone'} to ${accountObj?.name || 'account'}`;
                                amountClass = 'amount-positive';
                                typeIcon = 'fas fa-handshake';
                            }

                            const el = document.createElement('div');
                            el.className = 'simple-statement';
                            el.innerHTML = `
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <i class="${typeIcon}" style="color: var(--primary); font-size: 18px;"></i>
                                    <div style="flex: 1;">
                                        <div class="action">${statement}</div>
                                        <div class="date">${formatDate(tx.date)}</div>
                                    </div>
                                    <div class="amount ${amountClass}">${(tx.type === 'expense' || tx.type === 'lending') ? '-' : '+'}${formatCurrency(tx.amount)}</div>
                                </div>`;
                            recentContainer.appendChild(el);
                        });
                    }
                }

                // Transactions list for transactions page
                const transactionsList = document.getElementById('transactions-list');
                if (transactionsList) {
                    const filterFrom = document.getElementById('filter-from')?.value;
                    const filterTo = document.getElementById('filter-to')?.value;
                    const filterType = document.getElementById('filter-type')?.value;
                    
                    let filteredTransactions = transactions.filter(tx => {
                        if (filterType && filterType !== 'all' && tx.type !== filterType) return false;
                        if (filterFrom && new Date(tx.date) < new Date(filterFrom + 'T00:00:00')) return false;
                        if (filterTo && new Date(tx.date) > new Date(filterTo + 'T23:59:59')) return false;
                        return true;
                    });

                    transactionsList.innerHTML = '';
                    
                    if (filteredTransactions.length === 0) {
                        transactionsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-receipt"></i>
                                <h3>No Transactions Found</h3>
                                <p>Try adjusting your filters or add some transactions</p>
                            </div>`;
                    } else {
                        filteredTransactions.reverse().forEach((tx, index) => {
                            const categoryObj = categories.find(c => c.id === tx.category);
                            const accountObj = accounts.find(a => a.id === tx.account);
                            
                            // Create simple statement for each transaction
                            let statement = '';
                            let amountDisplay = '';
                            let typeClass = '';
                            
                            if (tx.type === 'expense') {
                                statement = `Money spent on ${tx.description || categoryObj?.name || 'expense'} from ${accountObj?.name || 'account'}`;
                                amountDisplay = `-${formatCurrency(tx.amount)}`;
                                typeClass = 'expense';
                            } else if (tx.type === 'income') {
                                statement = `Money received from ${tx.description || categoryObj?.name || 'income'} to ${accountObj?.name || 'account'}`;
                                amountDisplay = `+${formatCurrency(tx.amount)}`;
                                typeClass = 'income';
                            } else if (tx.type === 'transfer') {
                                const toAccountObj = accounts.find(a => a.id === tx.toAccount);
                                statement = `Money transferred from ${accountObj?.name || 'account'} to ${toAccountObj?.name || 'account'}`;
                                amountDisplay = formatCurrency(tx.amount);
                                typeClass = 'transfer';
                            } else if (tx.type === 'lending') {
                                statement = `Money lent to ${tx.person || 'someone'} from ${accountObj?.name || 'account'}`;
                                amountDisplay = `-${formatCurrency(tx.amount)}`;
                                typeClass = 'expense';
                            } else if (tx.type === 'borrowing') {
                                statement = `Money borrowed from ${tx.person || 'someone'} to ${accountObj?.name || 'account'}`;
                                amountDisplay = `+${formatCurrency(tx.amount)}`;
                                typeClass = 'income';
                            }

                            const item = document.createElement('div');
                            item.className = 'transaction-item';
                            item.innerHTML = `
                                <div class="transaction-info">
                                    <div class="transaction-type ${typeClass}">
                                        <i class="fas ${tx.type === 'expense' || tx.type === 'lending' ? 'fa-minus' : tx.type === 'income' || tx.type === 'borrowing' ? 'fa-plus' : 'fa-exchange-alt'}"></i>
                                        ${tx.type.charAt(0).toUpperCase() + tx.type.slice(1)}
                                    </div>
                                    <div class="transaction-description">${statement}</div>
                                    <div class="transaction-details">
                                        <span><i class="fas fa-calendar"></i> ${formatDate(tx.date)}</span>
                                        ${tx.person ? `<span><i class="fas fa-user"></i> ${tx.person}</span>` : ''}
                                    </div>
                                </div>
                                <div class="transaction-amount ${typeClass === 'expense' ? 'amount-negative' : typeClass === 'income' ? 'amount-positive' : ''}" style="display: flex; align-items: center; gap: 12px;">
                                    <span>${amountDisplay}</span>
                                    <button class="btn btn-danger btn-sm delete-transaction" data-index="${transactions.length - 1 - index}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>`;
                            transactionsList.appendChild(item);
                        });
                    }
                }

                // Debts list
                const debtsList = document.getElementById('debts-list');
                if (debtsList) {
                    const filteredDebts = debts.filter(d => currentDebtFilter === 'all' || d.type === currentDebtFilter);
                    debtsList.innerHTML = '';
                    
                    if (filteredDebts.length === 0) {
                        debtsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-handshake"></i>
                                <h3>No Debts</h3>
                                <p>Track money you lend or borrow here</p>
                            </div>`;
                    } else {
                        filteredDebts.forEach((d, index) => {
                            const accountObj = accounts.find(a => a.id === d.account);
                            let statement = '';
                            
                            if (d.type === 'lending') {
                                statement = `${d.person} owes you ${formatCurrency(d.amount)} (${d.description || 'No reason given'})`;
                            } else {
                                statement = `You owe ${d.person} ${formatCurrency(d.amount)} (${d.description || 'No reason given'})`;
                            }

                            const item = document.createElement('div');
                            item.className = 'transaction-item';
                            item.innerHTML = `
                                <div class="transaction-info">
                                    <div class="transaction-type ${d.type === 'lending' ? 'income' : 'expense'}">
                                        <i class="fas ${d.type === 'lending' ? 'fa-hand-holding-usd' : 'fa-handshake'}"></i>
                                        ${d.type === 'lending' ? 'Money Lent' : 'Money Borrowed'}
                                    </div>
                                    <div class="transaction-description">${statement}</div>
                                    <div class="transaction-details">
                                        <span><i class="fas fa-calendar"></i> ${formatDate(d.date)}</span>
                                        <span><i class="fas fa-university"></i> ${accountObj?.name || 'Unknown account'}</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <button class="btn btn-success btn-sm repay-debt" data-debt-index="${debts.indexOf(d)}">
                                        <i class="fas fa-check"></i> ${d.type === 'lending' ? 'Collect' : 'Repay'}
                                    </button>
                                    <button class="btn btn-danger btn-sm delete-debt" data-debt-index="${debts.indexOf(d)}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>`;
                            debtsList.appendChild(item);
                        });
                    }
                }

                // Budgets list
                const budgetsList = document.getElementById('budgets-list');
                if (budgetsList) {
                    budgetsList.innerHTML = '';
                    
                    if (budgets.length === 0) {
                        budgetsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-chart-pie"></i>
                                <h3>No Budgets Set</h3>
                                <p>Create budgets to control your spending</p>
                            </div>`;
                    } else {
                        budgets.forEach((b, index) => {
                            const now = new Date();
                            const spent = transactions
                                .filter(t => t.type === 'expense' && 
                                    (t.category === b.category || categories.find(c => c.id === t.category)?.name === b.category) &&
                                    new Date(t.date) >= new Date(now.getFullYear(), now.getMonth(), 1))
                                .reduce((sum, t) => sum + (t.amount || 0), 0);
                            
                            const percentage = Math.min((spent / b.amount) * 100, 100);
                            const remaining = Math.max(b.amount - spent, 0);
                            
                            let status = '';
                            let statusColor = '';
                            if (percentage >= 100) {
                                status = 'Budget exceeded!';
                                statusColor = 'var(--danger)';
                            } else if (percentage >= 80) {
                                status = 'Almost at limit';
                                statusColor = 'var(--warning)';
                            } else {
                                status = 'On track';
                                statusColor = 'var(--success)';
                            }

                            const item = document.createElement('div');
                            item.className = 'card';
                            item.style.marginBottom = '16px';
                            item.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                                    <div>
                                        <h3 style="margin: 0; font-size: 18px;">${b.category} Budget</h3>
                                        <p style="color: var(--text-muted); margin: 4px 0;">Monthly spending limit</p>
                                    </div>
                                    <span style="color: ${statusColor}; font-weight: 600; font-size: 14px;">${status}</span>
                                </div>
                                
                                <div style="margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span>Spent: ${formatCurrency(spent)}</span>
                                        <span>Remaining: ${formatCurrency(remaining)}</span>
                                    </div>
                                    <div class="budget-progress">
                                        <div class="progress-fill" style="width: ${percentage}%"></div>
                                    </div>
                                    <div style="font-size: 14px; color: var(--text-muted);">
                                        Budget: ${formatCurrency(b.amount)} (${b.period})
                                    </div>
                                </div>
                                
                                <div style="text-align: right;">
                                    <button class="btn btn-danger btn-sm delete-budget" data-budget-index="${index}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>`;
                            budgetsList.appendChild(item);
                        });
                    }
                }

                // Categories list
                const categoriesList = document.getElementById('categories-list');
                if (categoriesList) {
                    categoriesList.innerHTML = '';
                    const customCategories = categories.filter(c => !['food', 'groceries', 'transport', 'entertainment', 'utilities', 'healthcare', 'shopping', 'others-expense', 'salary', 'business', 'freelance', 'investment', 'gift', 'others-income', 'lending', 'borrowing', 'transfer'].includes(c.id));
                    
                    if (customCategories.length === 0) {
                        categoriesList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-tags"></i>
                                <h3>No Custom Categories</h3>
                                <p>Add categories to organize your transactions</p>
                            </div>`;
                    } else {
                        customCategories.forEach((c, index) => {
                            const item = document.createElement('div');
                            item.className = 'transaction-item';
                            item.innerHTML = `
                                <div class="transaction-info">
                                    <div class="transaction-type ${c.type}">
                                        <i class="fas fa-tag"></i>
                                        ${c.name}
                                    </div>
                                    <div class="transaction-description">
                                        ${c.type === 'expense' ? 'For spending money' : 'For receiving money'}
                                    </div>
                                </div>
                                <button class="btn btn-danger btn-sm delete-category" data-category-index="${categories.indexOf(c)}">
                                    <i class="fas fa-trash"></i>
                                </button>`;
                            categoriesList.appendChild(item);
                        });
                    }
                }

                // Update account lists in modals
                const accountSelects = document.querySelectorAll('#expense-account, #income-account, #debt-account, #repay-account, #transfer-from, #transfer-to');
                accountSelects.forEach(select => {
                    if (select) {
                        select.innerHTML = accounts.map(a => 
                            `<option value="${a.id}">${a.name} (${formatCurrency(a.balance)})</option>`
                        ).join('');
                    }
                });

                // Update category selects
                const expenseCategorySelect = document.getElementById('expense-category');
                const incomeCategorySelect = document.getElementById('income-category');
                const budgetCategorySelect = document.getElementById('budget-category');
                
                if (expenseCategorySelect) {
                    expenseCategorySelect.innerHTML = categories
                        .filter(c => c.type === 'expense')
                        .map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                }
                
                if (incomeCategorySelect) {
                    incomeCategorySelect.innerHTML = categories
                        .filter(c => c.type === 'income')
                        .map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                }
                
                if (budgetCategorySelect) {
                    budgetCategorySelect.innerHTML = categories
                        .filter(c => c.type === 'expense')
                        .map(c => `<option value="${c.name}">${c.name}</option>`).join('');
                }

                // Update accounts list in modal
                const accountsList = document.getElementById('accounts-list');
                if (accountsList) {
                    accountsList.innerHTML = accounts.map(a => `
                        <div class="card" style="margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="margin: 0; font-size: 16px;">${a.name}</h4>
                                    <p style="color: var(--text-muted); margin: 4px 0; text-transform: capitalize;">${a.type} Account</p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 18px; font-weight: 600;">${formatCurrency(a.balance)}</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">Current Balance</div>
                                </div>
                            </div>
                        </div>`).join('');
                }

            } catch (error) {
                console.error('Error updating UI:', error);
                showToast('Error updating display', 'error');
            }
        }

        // Transaction operations
        function addTransaction(tx) {
            tx.id = tx.id || uid('tx');
            tx.date = tx.date || todayISO();
            tx.amount = Number(tx.amount || 0);
            transactions.push(tx);
            recomputeBalances();
            updateUI();
        }

        function deleteTransaction(index) {
            try {
                if (index < 0 || index >= transactions.length) {
                    showToast('Invalid transaction', 'error');
                    return;
                }
                
                if (!confirm('Are you sure you want to delete this transaction?')) return;
                
                transactions.splice(index, 1);
                recomputeBalances();
                updateUI();
                showToast('Transaction deleted successfully', 'success');
            } catch (error) {
                showToast('Error deleting transaction', 'error');
            }
        }

        // Modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            modal.classList.add('active');
            
            // Set today's date for date inputs
            const dateInput = modal.querySelector('input[type="date"]');
            if (dateInput && !dateInput.value) {
                dateInput.value = todayISO();
            }
            
            // Close FAB menu
            const fabMenu = document.getElementById('fab-menu');
            const overlay = document.getElementById('overlay');
            if (fabMenu) fabMenu.classList.remove('active');
            if (overlay) overlay.style.display = 'none';
        }

        function closeModal(modal) {
            if (!modal) return;
            
            modal.classList.remove('active');
            
            // Clear form inputs except date and hidden inputs
            modal.querySelectorAll('input, select, textarea').forEach(input => {
                if (input.type !== 'date' && input.type !== 'hidden' && input.type !== 'file') {
                    input.value = '';
                }
            });
        }

        // Export PDF with working jsPDF
        function exportFilteredPDF() {
            try {
                // Check if jsPDF is available
                if (typeof window.jspdf === 'undefined') {
                    showToast('PDF export not available. Please check your internet connection.', 'error');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('UnifyX Finance Statement', 20, 20);
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 30);
                
                // Get filtered transactions
                const filterFrom = document.getElementById('filter-from')?.value;
                const filterTo = document.getElementById('filter-to')?.value;
                const filterType = document.getElementById('filter-type')?.value;
                
                let filteredTransactions = transactions.filter(tx => {
                    if (filterType && filterType !== 'all' && tx.type !== filterType) return false;
                    if (filterFrom && new Date(tx.date) < new Date(filterFrom + 'T00:00:00')) return false;
                    if (filterTo && new Date(tx.date) > new Date(filterTo + 'T23:59:59')) return false;
                    return true;
                });

                // Summary
                let y = 45;
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Summary:', 20, y);
                y += 10;
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Total Transactions: ${filteredTransactions.length}`, 20, y);
                y += 8;
                
                const totalExpenses = filteredTransactions
                    .filter(t => t.type === 'expense' || t.type === 'lending')
                    .reduce((sum, t) => sum + t.amount, 0);
                const totalIncome = filteredTransactions
                    .filter(t => t.type === 'income' || t.type === 'borrowing')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                doc.text(`Total Expenses: ${formatCurrency(totalExpenses)}`, 20, y);
                y += 8;
                doc.text(`Total Income: ${formatCurrency(totalIncome)}`, 20, y);
                y += 8;
                doc.text(`Net: ${formatCurrency(totalIncome - totalExpenses)}`, 20, y);
                y += 15;

                // Transactions table
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Transactions:', 20, y);
                y += 10;
                
                // Table headers
                doc.setFontSize(8);
                doc.setFont(undefined, 'bold');
                doc.text('Date', 20, y);
                doc.text('Type', 50, y);
                doc.text('Description', 80, y);
                doc.text('Amount', 140, y);
                doc.text('Account', 170, y);
                y += 8;
                
                // Table content
                doc.setFont(undefined, 'normal');
                filteredTransactions.reverse().forEach(tx => {
                    if (y > 270) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    const categoryObj = categories.find(c => c.id === tx.category);
                    const accountObj = accounts.find(a => a.id === tx.account);
                    const description = tx.description || categoryObj?.name || tx.type;
                    const amount = (tx.type === 'expense' || tx.type === 'lending' ? '-' : '+') + formatCurrency(tx.amount);
                    
                    doc.text(formatDate(tx.date), 20, y);
                    doc.text(tx.type.charAt(0).toUpperCase() + tx.type.slice(1), 50, y);
                    doc.text(description.substring(0, 20), 80, y);
                    doc.text(amount, 140, y);
                    doc.text(accountObj?.name || '', 170, y);
                    y += 6;
                });

                // Save the PDF
                doc.save(`unifyx_statement_${new Date().toISOString().split('T')[0]}.pdf`);
                showToast('PDF exported successfully!', 'success');
                
            } catch (error) {
                console.error('PDF Export Error:', error);
                showToast('Error exporting PDF: ' + error.message, 'error');
            }
        }

        // Export data as Excel
        function exportData() {
            try {
                const wb = XLSX.utils.book_new();

                // Summary sheet
                const summaryData = [
                    ['UnifyX Finance Manager Report'],
                    ['Generated On', new Date().toISOString()],
                    ['Total Balance', formatCurrency(accounts.reduce((sum, acc) => sum + (acc.balance || 0), 0))],
                    [''],
                    ['Account Balances'],
                    ...accounts.map(a => [a.name, a.type, formatCurrency(a.balance)])
                ];
                
                const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, wsSummary, 'Summary');

                // Transactions sheet
                const transactionsData = transactions.map(t => {
                    const categoryObj = categories.find(c => c.id === t.category);
                    const accountObj = accounts.find(a => a.id === t.account);
                    const toAccountObj = accounts.find(a => a.id === t.toAccount);
                    
                    return {
                        Date: formatDate(t.date),
                        Type: t.type.charAt(0).toUpperCase() + t.type.slice(1),
                        Category: categoryObj?.name || t.category,
                        Description: t.description || '',
                        Amount: t.amount,
                        Account: accountObj?.name || t.account,
                        'To Account': toAccountObj?.name || '',
                        Person: t.person || ''
                    };
                });
                
                const wsTransactions = XLSX.utils.json_to_sheet(transactionsData);
                XLSX.utils.book_append_sheet(wb, wsTransactions, 'Transactions');

                // Debts sheet
                const debtsData = debts.map(d => {
                    const accountObj = accounts.find(a => a.id === d.account);
                    return {
                        Date: formatDate(d.date),
                        Type: d.type.charAt(0).toUpperCase() + d.type.slice(1),
                        Person: d.person,
                        Description: d.description,
                        Amount: d.amount,
                        Account: accountObj?.name || d.account
                    };
                });
                
                const wsDebts = XLSX.utils.json_to_sheet(debtsData);
                XLSX.utils.book_append_sheet(wb, wsDebts, 'Debts');

                // Save file
                const timestamp = new Date().toISOString().replace(/[-:T]/g, '').split('.')[0];
                XLSX.writeFile(wb, `unifyx_finance_data_${timestamp}.xlsx`);
                showToast('Data exported successfully!', 'success');
                
            } catch (error) {
                showToast('Error exporting data: ' + error.message, 'error');
            }
        }

        // Import data from Excel
        function importData(file) {
            try {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        // Import transactions
                        if (workbook.Sheets['Transactions']) {
                            const newTransactions = XLSX.utils.sheet_to_json(workbook.Sheets['Transactions']);
                            transactions = newTransactions.map(t => {
                                const account = accounts.find(a => a.name.toLowerCase() === (t.Account || '').toLowerCase());
                                const category = categories.find(c => c.name.toLowerCase() === (t.Category || '').toLowerCase());
                                
                                return {
                                    id: uid('tx'),
                                    type: (t.Type || '').toLowerCase(),
                                    amount: parseFloat(t.Amount) || 0,
                                    category: category?.id || 'others-expense',
                                    description: t.Description || '',
                                    date: new Date(t.Date).toISOString().split('T')[0],
                                    account: account?.id || accounts[0]?.id,
                                    person: t.Person || ''
                                };
                            }).filter(t => t.type && t.amount && t.date && t.account);
                        }
                        
                        // Import debts
                        if (workbook.Sheets['Debts']) {
                            const newDebts = XLSX.utils.sheet_to_json(workbook.Sheets['Debts']);
                            debts = newDebts.map(d => {
                                const account = accounts.find(a => a.name.toLowerCase() === (d.Account || '').toLowerCase());
                                
                                return {
                                    type: (d.Type || '').toLowerCase(),
                                    amount: parseFloat(d.Amount) || 0,
                                    person: d.Person || '',
                                    description: d.Description || '',
                                    date: new Date(d.Date).toISOString().split('T')[0],
                                    account: account?.id || accounts[0]?.id
                                };
                            }).filter(d => d.type && d.amount && d.person && d.date && d.account);
                        }
                        
                        recomputeBalances();
                        updateUI();
                        showToast('Data imported successfully!', 'success');
                        
                    } catch (error) {
                        showToast('Error reading file: ' + error.message, 'error');
                    }
                };
                
                reader.onerror = () => showToast('Error reading file', 'error');
                reader.readAsArrayBuffer(file);
                
            } catch (error) {
                showToast('Error importing data: ' + error.message, 'error');
            }
        }

        // Reset all data
        function resetData() {
            if (!confirm('Are you sure you want to delete ALL your financial data? This cannot be undone!')) return;
            
            try {
                accounts = [
                    { id: 'cash', name: 'Cash', type: 'cash', initialBalance: 0, balance: 0 },
                    { id: 'bank', name: 'Bank', type: 'bank', initialBalance: 0, balance: 0 }
                ];
                transactions = [];
                debts = [];
                budgets = [];
                categories = [
                    { id: 'food', name: 'Food & Dining', type: 'expense' },
                    { id: 'groceries', name: 'Groceries', type: 'expense' },
                    { id: 'transport', name: 'Transportation', type: 'expense' },
                    { id: 'entertainment', name: 'Entertainment', type: 'expense' },
                    { id: 'utilities', name: 'Bills & Utilities', type: 'expense' },
                    { id: 'healthcare', name: 'Healthcare', type: 'expense' },
                    { id: 'shopping', name: 'Shopping', type: 'expense' },
                    { id: 'others-expense', name: 'Others', type: 'expense' },
                    { id: 'salary', name: 'Salary', type: 'income' },
                    { id: 'business', name: 'Business', type: 'income' },
                    { id: 'freelance', name: 'Freelance', type: 'income' },
                    { id: 'investment', name: 'Investment Returns', type: 'income' },
                    { id: 'gift', name: 'Gift/Bonus', type: 'income' },
                    { id: 'others-income', name: 'Others', type: 'income' },
                    { id: 'lending', name: 'Lending', type: 'expense' },
                    { id: 'borrowing', name: 'Borrowing', type: 'income' },
                    { id: 'transfer', name: 'Transfer', type: 'transfer' }
                ];
                settings = {
                    initialized: false,
                    currency: '₹',
                    theme: 'light',
                    initialBalances: {}
                };
                
                updateUI();
                showToast('All data has been reset!', 'success');
                
                // Show setup again
                document.getElementById('setup-wallet').style.display = 'block';
                document.getElementById('dashboard-content').style.display = 'none';
                document.getElementById('overlay').style.display = 'block';
                
            } catch (error) {
                showToast('Error resetting data', 'error');
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            setCurrentYear();
            applyTheme();
            
            // Check if wallet is set up
            if (!settings.initialized) {
                document.getElementById('setup-wallet').style.display = 'block';
                document.getElementById('dashboard-content').style.display = 'none';
                document.getElementById('overlay').style.display = 'block';
            } else {
                updateUI();
            }

            // Setup wallet
            document.getElementById('save-wallet-btn')?.addEventListener('click', () => {
                const cash = parseFloat(document.getElementById('setup-cash').value) || 0;
                const bank = parseFloat(document.getElementById('setup-bank').value) || 0;
                const currency = document.getElementById('currency-select').value;
                
                settings.currency = currency;
                initDefaultAccounts(cash, bank);
                
                document.getElementById('setup-wallet').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
                document.getElementById('overlay').style.display = 'none';
                
                updateUI();
                showToast('Welcome! Your wallet is ready to use!', 'success');
            });

            document.getElementById('skip-setup')?.addEventListener('click', () => {
                initDefaultAccounts(0, 0);
                document.getElementById('setup-wallet').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
                document.getElementById('overlay').style.display = 'none';
                updateUI();
                showToast('Setup skipped. You can add money later!', 'success');
            });

            // FAB Menu
            const fab = document.getElementById('fab');
            const fabMenu = document.getElementById('fab-menu');
            const overlay = document.getElementById('overlay');
            
            if (fab && fabMenu && overlay) {
                fab.addEventListener('click', () => {
                    fabMenu.classList.toggle('active');
                    overlay.style.display = fabMenu.classList.contains('active') ? 'block' : 'none';
                });
                
                overlay.addEventListener('click', () => {
                    fabMenu.classList.remove('active');
                    overlay.style.display = 'none';
                });
            }

            // Navigation
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Update active nav item
                    document.querySelectorAll('.bottom-nav-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show corresponding section
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    const sectionId = item.getAttribute('data-section');
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('active');
                        
                        // Special handling for insights section
                        if (sectionId === 'insights') {
                            // You can add chart initialization here if needed
                        }
                    }
                });
            });

            // Quick actions
            document.getElementById('quick-expense')?.addEventListener('click', () => openModal('expense-modal'));
            document.getElementById('quick-income')?.addEventListener('click', () => openModal('income-modal'));
            document.getElementById('quick-transfer')?.addEventListener('click', () => openModal('transfer-modal'));
            document.getElementById('quick-debt')?.addEventListener('click', () => openModal('debt-modal'));

            // FAB Menu Actions
            document.getElementById('btn-add-expense')?.addEventListener('click', () => openModal('expense-modal'));
            document.getElementById('btn-add-income')?.addEventListener('click', () => openModal('income-modal'));
            document.getElementById('btn-add-transfer')?.addEventListener('click', () => openModal('transfer-modal'));
            document.getElementById('btn-add-debt')?.addEventListener('click', () => openModal('debt-modal'));
            document.getElementById('btn-add-account')?.addEventListener('click', () => openModal('add-account-modal'));

            // Modal triggers
            document.getElementById('view-accounts')?.addEventListener('click', () => openModal('accounts-modal'));
            document.getElementById('add-new-account-btn')?.addEventListener('click', () => {
                closeModal(document.getElementById('accounts-modal'));
                setTimeout(() => openModal('add-account-modal'), 100);
            });
            document.getElementById('add-budget-btn')?.addEventListener('click', () => openModal('budget-modal'));
            document.getElementById('add-category-btn')?.addEventListener('click', () => openModal('category-modal'));
            document.getElementById('settings-btn')?.addEventListener('click', () => {
                // Pre-fill settings
                const currencySelect = document.getElementById('settings-currency');
                const themeSelect = document.getElementById('settings-theme');
                if (currencySelect) currencySelect.value = settings.currency;
                if (themeSelect) themeSelect.value = settings.theme;
                openModal('settings-modal');
            });
            document.getElementById('insights-btn')?.addEventListener('click', () => {
                document.querySelector('.bottom-nav-item[data-section="insights"]')?.click();
            });
            document.getElementById('view-all-transactions')?.addEventListener('click', () => {
                document.querySelector('.bottom-nav-item[data-section="transactions"]')?.click();
            });

            // Modal close handlers
            document.querySelectorAll('.close-modal, .close-modal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const modal = btn.closest('.modal');
                    if (modal) closeModal(modal);
                });
            });

            // Form submissions
            document.getElementById('save-expense')?.addEventListener('click', () => {
                const amount = parseFloat(document.getElementById('expense-amount').value);
                const category = document.getElementById('expense-category').value;
                const description = document.getElementById('expense-description').value;
                const date = document.getElementById('expense-date').value;
                const accountId = document.getElementById('expense-account').value;
                
                if (!amount || amount <= 0) {
                    showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                if (!category || !date || !accountId) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }
                
                addTransaction({
                    type: 'expense',
                    amount,
                    category,
                    description,
                    date,
                    account: accountId
                });
                
                closeModal(document.getElementById('expense-modal'));
                showToast('Expense added successfully!', 'success');
            });

            document.getElementById('save-income')?.addEventListener('click', () => {
                const amount = parseFloat(document.getElementById('income-amount').value);
                const category = document.getElementById('income-category').value;
                const description = document.getElementById('income-description').value;
                const date = document.getElementById('income-date').value;
                const accountId = document.getElementById('income-account').value;
                
                if (!amount || amount <= 0) {
                    showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                if (!category || !date || !accountId) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }
                
                addTransaction({
                    type: 'income',
                    amount,
                    category,
                    description,
                    date,
                    account: accountId
                });
                
                closeModal(document.getElementById('income-modal'));
                showToast('Income added successfully!', 'success');
            });

            document.getElementById('save-debt')?.addEventListener('click', () => {
                const type = document.getElementById('debt-type').value;
                const amount = parseFloat(document.getElementById('debt-amount').value);
                const person = document.getElementById('debt-person').value.trim();
                const description = document.getElementById('debt-description').value;
                const date = document.getElementById('debt-date').value;
                const accountId = document.getElementById('debt-account').value;
                
                if (!amount || amount <= 0) {
                    showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                if (!person) {
                    showToast('Please enter person\'s name', 'error');
                    return;
                }
                
                if (!type || !date || !accountId) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }
                
                // Add transaction
                addTransaction({
                    type,
                    amount,
                    category: type === 'lending' ? 'lending' : 'borrowing',
                    description: description || `${type === 'lending' ? 'Lent to' : 'Borrowed from'} ${person}`,
                    date,
                    account: accountId,
                    person
                });
                
                // Add to debts list
                debts.push({
                    type,
                    amount,
                    person,
                    description,
                    date,
                    account: accountId
                });
                
                updateUI();
                closeModal(document.getElementById('debt-modal'));
                showToast(`${type === 'lending' ? 'Lending' : 'Borrowing'} recorded successfully!`, 'success');
            });

            document.getElementById('save-transfer')?.addEventListener('click', () => {
                const amount = parseFloat(document.getElementById('transfer-amount').value);
                const fromAccountId = document.getElementById('transfer-from').value;
                const toAccountId = document.getElementById('transfer-to').value;
                const description = document.getElementById('transfer-description').value;
                const date = document.getElementById('transfer-date').value;
                
                if (!amount || amount <= 0) {
                    showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                if (!fromAccountId || !toAccountId || fromAccountId === toAccountId) {
                    showToast('Please select different accounts for transfer', 'error');
                    return;
                }
                
                if (!date) {
                    showToast('Please select a date', 'error');
                    return;
                }
                
                // Check if from account has sufficient balance
                const fromAccount = accounts.find(a => a.id === fromAccountId);
                if (fromAccount && fromAccount.balance < amount) {
                    if (!confirm(`Insufficient balance in ${fromAccount.name}. Current balance: ${formatCurrency(fromAccount.balance)}. Continue anyway?`)) {
                        return;
                    }
                }
                
                addTransaction({
                    type: 'transfer',
                    amount,
                    category: 'transfer',
                    description: description || 'Account Transfer',
                    date,
                    account: fromAccountId,
                    fromAccount: fromAccountId,
                    toAccount: toAccountId
                });
                
                closeModal(document.getElementById('transfer-modal'));
                showToast('Transfer completed successfully!', 'success');
            });

            document.getElementById('save-account')?.addEventListener('click', () => {
                const name = document.getElementById('account-name').value.trim();
                const type = document.getElementById('account-type').value;
                const balance = parseFloat(document.getElementById('account-balance').value) || 0;
                
                if (!name) {
                    showToast('Please enter account name', 'error');
                    return;
                }
                
                if (!type) {
                    showToast('Please select account type', 'error');
                    return;
                }
                
                // Check if account name already exists
                if (accounts.some(a => a.name.toLowerCase() === name.toLowerCase())) {
                    showToast('Account with this name already exists', 'error');
                    return;
                }
                
                const newAccount = {
                    id: name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now(),
                    name,
                    type,
                    initialBalance: balance,
                    balance
                };
                
                accounts.push(newAccount);
                updateUI();
                closeModal(document.getElementById('add-account-modal'));
                showToast('Account added successfully!', 'success');
            });

            document.getElementById('save-budget')?.addEventListener('click', () => {
                const category = document.getElementById('budget-category').value;
                const amount = parseFloat(document.getElementById('budget-amount').value);
                const period = document.getElementById('budget-period').value;
                
                if (!category) {
                    showToast('Please select a category', 'error');
                    return;
                }
                
                if (!amount || amount <= 0) {
                    showToast('Please enter a valid budget amount', 'error');
                    return;
                }
                
                // Check if budget already exists for this category
                if (budgets.some(b => b.category === category)) {
                    showToast('Budget already exists for this category', 'error');
                    return;
                }
                
                budgets.push({ category, amount, period });
                updateUI();
                closeModal(document.getElementById('budget-modal'));
                showToast('Budget created successfully!', 'success');
            });

            document.getElementById('save-category')?.addEventListener('click', () => {
                const name = document.getElementById('category-name').value.trim();
                const type = document.getElementById('category-type').value;
                
                if (!name) {
                    showToast('Please enter category name', 'error');
                    return;
                }
                
                if (!type) {
                    showToast('Please select category type', 'error');
                    return;
                }
                
                // Check if category already exists
                if (categories.some(c => c.name.toLowerCase() === name.toLowerCase())) {
                    showToast('Category with this name already exists', 'error');
                    return;
                }
                
                const newCategory = {
                    id: name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now(),
                    name,
                    type
                };
                
                categories.push(newCategory);
                updateUI();
                closeModal(document.getElementById('category-modal'));
                showToast('Category added successfully!', 'success');
            });

            document.getElementById('save-settings')?.addEventListener('click', () => {
                const currency = document.getElementById('settings-currency').value;
                const theme = document.getElementById('settings-theme').value;
                
                settings.currency = currency;
                settings.theme = theme;
                
                applyTheme();
                updateUI();
                closeModal(document.getElementById('settings-modal'));
                showToast('Settings saved!', 'success');
            });

            // Debt repayment
            document.getElementById('save-repay-debt')?.addEventListener('click', () => {
                const index = parseInt(document.getElementById('repay-debt-index').value);
                const amount = parseFloat(document.getElementById('repay-amount').value);
                const date = document.getElementById('repay-date').value;
                const accountId = document.getElementById('repay-account').value;
                
                if (!amount || amount <= 0) {
                    showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                if (!date || !accountId) {
                    showToast('Please fill all required fields', 'error');
                    return;
                }
                
                const debt = debts[index];
                if (!debt) {
                    showToast('Invalid debt selected', 'error');
                    return;
                }
                
                if (amount > debt.amount) {
                    showToast('Repayment amount cannot exceed debt amount', 'error');
                    return;
                }
                
                // Add transaction for repayment
                if (debt.type === 'lending') {
                    // Collecting money
                    addTransaction({
                        type: 'income',
                        amount,
                        category: 'others-income',
                        description: `Money collected from ${debt.person}`,
                        date,
                        account: accountId,
                        person: debt.person
                    });
                } else {
                    // Repaying money
                    addTransaction({
                        type: 'expense',
                        amount,
                        category: 'others-expense',
                        description: `Money repaid to ${debt.person}`,
                        date,
                        account: accountId,
                        person: debt.person
                    });
                }
                
                // Update debt amount
                debt.amount -= amount;
                
                // Remove debt if fully paid
                if (debt.amount <= 0) {
                    debts.splice(index, 1);
                    showToast(`${debt.type === 'lending' ? 'Debt fully collected!' : 'Debt fully repaid!'}`, 'success');
                } else {
                    showToast(`Partial ${debt.type === 'lending' ? 'collection' : 'repayment'} recorded`, 'success');
                }
                
                updateUI();
                closeModal(document.getElementById('repay-debt-modal'));
            });

            // Filter and export
            document.getElementById('apply-filters')?.addEventListener('click', () => {
                updateUI();
                showToast('Filters applied', 'success');
            });

            document.getElementById('clear-filters')?.addEventListener('click', () => {
                document.getElementById('filter-from').value = '';
                document.getElementById('filter-to').value = '';
                document.getElementById('filter-type').value = 'all';
                updateUI();
                showToast('Filters cleared', 'success');
            });

            document.getElementById('export-pdf')?.addEventListener('click', exportFilteredPDF);
            document.getElementById('export-data')?.addEventListener('click', exportData);

            document.getElementById('import-data')?.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    importData(file);
                    e.target.value = ''; // Clear file input
                }
            });

            document.getElementById('reset-data')?.addEventListener('click', resetData);

            // Debt filter buttons
            document.querySelectorAll('[data-debt-filter]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-debt-filter]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentDebtFilter = btn.getAttribute('data-debt-filter');
                    updateUI();
                });
            });

            // Delete handlers - Event delegation
            document.addEventListener('click', (e) => {
                if (e.target.closest('.delete-transaction')) {
                    const index = parseInt(e.target.closest('.delete-transaction').dataset.index);
                    deleteTransaction(index);
                } else if (e.target.closest('.delete-debt')) {
                    const index = parseInt(e.target.closest('.delete-debt').dataset.debtIndex);
                    if (confirm('Are you sure you want to delete this debt record?')) {
                        debts.splice(index, 1);
                        updateUI();
                        showToast('Debt record deleted', 'success');
                    }
                } else if (e.target.closest('.repay-debt')) {
                    const index = parseInt(e.target.closest('.repay-debt').dataset.debtIndex);
                    const debt = debts[index];
                    if (debt) {
                        document.getElementById('repay-amount').value = debt.amount;
                        document.getElementById('repay-date').value = todayISO();
                        document.getElementById('repay-debt-index').value = index;
                        openModal('repay-debt-modal');
                    }
                } else if (e.target.closest('.delete-budget')) {
                    const index = parseInt(e.target.closest('.delete-budget').dataset.budgetIndex);
                    if (confirm('Are you sure you want to delete this budget?')) {
                        budgets.splice(index, 1);
                        updateUI();
                        showToast('Budget deleted', 'success');
                    }
                } else if (e.target.closest('.delete-category')) {
                    const index = parseInt(e.target.closest('.delete-category').dataset.categoryIndex);
                    const category = categories[index];
                    
                    // Check if category is in use
                    if (transactions.some(t => t.category === category.id)) {
                        showToast('Cannot delete category that is being used in transactions', 'error');
                        return;
                    }
                    
                    if (confirm('Are you sure you want to delete this category?')) {
                        categories.splice(index, 1);
                        updateUI();
                        showToast('Category deleted', 'success');
                    }
                }
            });

            // Initialize UI
            updateUI();
        });

        // Make deleteTransaction available globally for backward compatibility
        window.deleteTransaction = deleteTransaction;
    </script>
</body>
</html>