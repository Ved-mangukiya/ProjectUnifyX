<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/pdf-lib@1.21.0/dist/pdf-lib.min.js"></script>
</head>
<body>
  <input type="file" id="fileInput" accept=".pdf">
  <input type="text" id="password" value="password123">
  <button onclick="encrypt()">Encrypt</button>
  <script>
    async function encrypt() {
      console.log("Encrypting...");
      const file = document.getElementById('fileInput').files[0];
      const password = document.getElementById('password').value;
      console.log("Loading PDF...");
      const pdfDoc = await PDFLib.PDFDocument.load(await file.arrayBuffer());
      console.log("Applying encryption...");
      const pdfBytes = await pdfDoc.save({
        userPassword: password,
        ownerPassword: password,
      });
      console.log("Verifying...");
      try {
        await PDFLib.PDFDocument.load(pdfBytes);
        console.error("Not encrypted!");
        alert("Encryption failed!");
        return;
      } catch (e) {
        console.log("Requires password, good.");
      }
      const verified = await PDFLib.PDFDocument.load(pdfBytes, { password });
      console.log("Verified, downloading...");
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "test.pdf";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>